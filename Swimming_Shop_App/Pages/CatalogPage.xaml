<Page x:Class="Swimming_Shop_App.Pages.CatalogPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Каталог">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель фильтров -->
        <StackPanel Margin="0,0,0,15">
            <!-- Строка поиска -->
            <Border Background="#f8f9fa" CornerRadius="8" Padding="15" Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="SearchText" 
                             Width="300" 
                             FontSize="14"
                             VerticalAlignment="Center"
                             Margin="0,0,10,0"
                             KeyDown="SearchText_KeyDown"/>
                    <TextBlock Text="Поиск товаров..." 
                               Foreground="Gray" 
                               IsHitTestVisible="False"
                               VerticalAlignment="Center"
                               Margin="8,0,0,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=SearchText}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Content="Найти" 
                            Click="SearchButton_Click" 
                            Padding="12,6" 
                            Margin="10,0,5,0"
                            Background="#0d6efd"
                            Foreground="White"
                            BorderBrush="#0d6efd"
                            FontWeight="SemiBold"/>
                    <Button Content="Очистить" 
                            Click="ClearSearch_Click" 
                            Padding="8,4" 
                            Margin="5,0,0,0"
                            Background="#e9ecef"
                            BorderBrush="#dee2e6"/>
                </StackPanel>
            </Border>
            
            <!-- Фильтры -->
            <Border Background="#f8f9fa" CornerRadius="8" Padding="15">
                <StackPanel>
                    <TextBlock Text="Фильтры" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <StackPanel Orientation="Horizontal">
                        
                        <StackPanel Margin="0,0,20,0">
                            <TextBlock Text="Цена (₽):" FontSize="12" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="MinPriceText" 
                                         Width="70" 
                                         Margin="0,0,5,0"
                                         ToolTip="Минимальная цена в рублях"/>
                                <TextBlock Text="—" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="MaxPriceText" 
                                         Width="70"
                                         ToolTip="Максимальная цена в рублях"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <StackPanel Margin="0,0,20,0">
                            <TextBlock Text="Наличие:" FontSize="12" Margin="0,0,0,4"/>
                            <CheckBox x:Name="AvailableOnlyCheck" 
                                      Content="Только в наличии" 
                                      Checked="AvailabilityChanged" 
                                      Unchecked="AvailabilityChanged"/>
                        </StackPanel>
                        
                        <StackPanel VerticalAlignment="Bottom">
                            <Button Content="Применить" 
                                    Click="ApplyFilters_Click" 
                                    Padding="15,6" 
                                    Margin="0,0,8,0"
                                    Background="#0d6efd"
                                    Foreground="White"
                                    BorderBrush="#0d6efd"/>
                        </StackPanel>
                        
                        <StackPanel VerticalAlignment="Bottom">
                            <Button Content="Сбросить" 
                                    Click="ResetFilters_Click" 
                                    Padding="15,6"
                                    Background="#6c757d"
                                    Foreground="White"
                                    BorderBrush="#6c757d"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Список товаров -->
        <Grid Grid.Row="1">
            <!-- Индикатор загрузки -->
            <StackPanel x:Name="LoadingPanel" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Visibility="Collapsed">
                <TextBlock Text="🔄" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                <TextBlock Text="Загрузка товаров..." FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
            
            <!-- Сообщение о пустом результате -->
            <StackPanel x:Name="EmptyResultPanel" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Visibility="Collapsed">
                <TextBlock Text="🔍" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                <TextBlock Text="Товары не найдены" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                <TextBlock Text="Попробуйте изменить параметры поиска" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
            </StackPanel>
            
            <!-- Список товаров -->
            <ScrollViewer x:Name="ProductsScrollViewer">
                <ItemsControl ItemsSource="{Binding Products}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#e9ecef" 
                                    BorderThickness="1" 
                                    Background="White"
                                    CornerRadius="12"
                                    Padding="28" 
                                    Margin="0,0,0,20">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="16" ShadowDepth="3" Color="#22000000" Opacity="0.18"/>
                                </Border.Effect>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="380"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="260"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Изображение товара (увеличено, без обрезания) -->
                                    <Border Grid.Column="0" 
                                            Background="#f8f9fa" 
                                            CornerRadius="10"
                                            Width="320" 
                                            Height="320">
                                        <Image Source="{Binding PictureProduct}" 
                                               Stretch="Uniform" 
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"/>
                                    </Border>
                                    
                                    <!-- Информация о товаре (крупнее шрифты, больше отступы) -->
                                    <StackPanel Grid.Column="1" Margin="24,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding NameProduct}" 
                                                   FontWeight="SemiBold" 
                                                   FontSize="24"
                                                   Margin="0,0,0,10"/>
                                        <TextBlock Text="{Binding DescriptionProduct}" 
                                                   TextWrapping="Wrap" 
                                                   Foreground="#6c757d"
                                                   FontSize="16"
                                                   MaxHeight="80"
                                                   Margin="0,0,0,14"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="На складе: " 
                                                       FontSize="16" 
                                                       Foreground="#6c757d"/>
                                            <TextBlock Text="{Binding CountProduct}" 
                                                       FontSize="16" 
                                                       FontWeight="SemiBold"
                                                       Foreground="#28a745"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- Цена и кнопка (крупнее) -->
                                    <StackPanel Grid.Column="2" 
                                                HorizontalAlignment="Right" 
                                                VerticalAlignment="Center">
                                        <TextBlock Text="{Binding PriceProduct, StringFormat={}{0:F2} ₽}" 
                                                   FontSize="26" 
                                                   FontWeight="Bold" 
                                                   Foreground="#0d6efd"
                                                   HorizontalAlignment="Right"
                                                   Margin="0,0,0,18"/>
                                        <Button Content="В корзину" 
                                                Padding="20,12" 
                                                Tag="{Binding}" 
                                                Click="AddToCart_Click"
                                                Background="#28a745"
                                                Foreground="White"
                                                BorderBrush="#28a745"
                                                FontWeight="SemiBold"
                                                Width="200"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>